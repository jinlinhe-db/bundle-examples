trigger:
- main

pool:
  vmImage: ubuntu-22.04

variables:
 - name: BUNDLE_TARGET
   value: dev


steps:
  - checkout: self

  - script: |
      databricks bundle validate -t $(BUNDLE_TARGET)
    displayName: Validate bundle
    workingDirectory: mlops_stacks/mlops_stacks
    env:
      DATABRICKS_CLIENT_ID: $(DATABRICKS_CLIENT_ID)
      DATABRICKS_CLIENT_SECRET: $(DATABRICKS_CLIENT_SECRET)

  - script: |
      databricks bundle deploy -t $(BUNDLE_TARGET)
    displayName: Deploy bundle
    workingDirectory: mlops_stacks/mlops_stacks
    env:
      DATABRICKS_CLIENT_ID: $(DATABRICKS_CLIENT_ID)
      DATABRICKS_CLIENT_SECRET: $(DATABRICKS_CLIENT_SECRET)

